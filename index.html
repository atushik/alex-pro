<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Connexion - Alex Pro</title>
<link rel="manifest" href="./manifest-pro.json">
<meta name="theme-color" content="#6b23ff">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="logo-pro.jpg">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
  body{font-family:'Segoe UI',sans-serif;background:#f2f2f7;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;margin:0;padding:20px}
  .card{background:#fff;padding:30px;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,0.1);text-align:center;width:100%;max-width:350px}
  input{width:100%;padding:15px;margin:10px 0;border:1px solid #ddd;border-radius:12px;font-size:1.2em;text-align:center;letter-spacing:5px;box-sizing:border-box}
  button{width:100%;padding:15px;background:#6b23ff;color:#fff;border:none;border-radius:12px;font-size:1.1em;font-weight:bold;cursor:pointer;margin-top:10px;transition:0.3s}
  button:active{transform:scale(0.98)}
  .logo{width:90px;height:90px;border-radius:20px;object-fit:cover;margin-bottom:20px;box-shadow:0 4px 15px rgba(107,35,255,0.2)}
  a{text-decoration:none}
</style>
</head>
<body>
  <div class="card">
    <img src="logo-pro.jpg" class="logo">
    <h2 style="margin:0 0 10px 0;color:#333">AlexLivraison Pro</h2>
    <p style="color:#666;margin-bottom:25px">Application Réservée aux Livreurs</p>
    
    <input type="password" id="pin" placeholder="Code PIN" maxlength="8">
    <button onclick="login()">SE CONNECTER</button>
    
    <div style="margin-top:25px;border-top:1px solid #eee;padding-top:20px">
        <p style="margin:0;font-size:0.9em;color:#888">Vous n'avez pas de compte ?</p>
        <a href="devenir-coursiers.html" style="display:block;margin-top:10px;color:#6b23ff;font-weight:700">Créer un compte Coursier</a>
    </div>
  </div>

<script>
const firebaseConfig={apiKey:"AIzaSyAWagPwv5Skh_EHfdcnFTYeG-xltRM7yPc",authDomain:"alex-livraison.firebaseapp.com",projectId:"alex-livraison",storageBucket:"alex-livraison.firebasestorage.app",messagingSenderId:"937475497279",appId:"1:937475497279:web:62dc9eba8e77a5113ec78a"};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

if('serviceWorker' in navigator){navigator.serviceWorker.register('./sw.js').catch(console.error);}
if(localStorage.getItem('alex_courier_logged')) window.location.href='dashboard-coursiers.html';

async function login() {
    const pin = document.getElementById('pin').value.trim();
    if(!pin) return alert("Veuillez entrer votre code PIN");
    
    const btn = document.querySelector('button');
    btn.innerText = "Vérification...";
    
    try {
        const snap = await db.collection('couriers').where('password', '==', pin).get();
        if(!snap.empty) {
            const doc = snap.docs[0];
            const data = doc.data();
            
            if(data.status === 'pending') {
                alert("Votre compte est en attente de validation par l'administrateur.");
                btn.innerText = "SE CONNECTER";
                return;
            }
            
            localStorage.setItem('alex_courier_logged', 'true');
            localStorage.setItem('alex_courier_id', doc.id);
            localStorage.setItem('alex_courier_name', data.fullName);
            window.location.href = 'dashboard-coursiers.html';
        } else {
            alert("Code PIN incorrect ou compte introuvable.");
            btn.innerText = "SE CONNECTER";
        }
    } catch(e) { 
        alert("Erreur de connexion. Vérifiez internet.");
        btn.innerText = "SE CONNECTER";
    }
}
</script>
</body>
</html> 
